<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Client View - Metal Processing</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e1e;
      color: white;
    }
    h1 {
      text-align: center;
    }
    #searchBar {
      width: 100%;
      padding: 12px;
      margin: 20px auto;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      max-width: 600px;
      display: block;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .card {
      background-color: #2c2c2c;
      padding: 20px;
      border-radius: 10px;
      position: relative;
    }
    .card h2 {
      margin-top: 0;
    }
    .media {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .media img, .media video {
      max-width: 100%;
      border-radius: 6px;
    }
    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: crimson;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .pagination {
      margin-top: 30px;
      text-align: center;
    }
    .pagination button {
      padding: 8px 16px;
      margin: 0 5px;
      border: none;
      background: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .pagination button:disabled {
      background: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Metal Processing Showcase</h1>
  <input type="text" id="searchBar" placeholder="Search by section or description..." oninput="renderCards()">
  <div class="grid" id="contentGrid"></div>
  <div class="pagination">
    <button onclick="changePage(-1)" id="prevBtn">Previous</button>
    <button onclick="changePage(1)" id="nextBtn">Next</button>
  </div>

  <script>
    const sections = ["cutting", "welding", "polishing", "coating"];
    const itemsPerPage = 4;
    let currentPage = 1;
    let allCards = [];

    function loadAllData() {
      const result = [];
      sections.forEach(section => {
        const texts = JSON.parse(localStorage.getItem(section + 'Texts') || '[]');
        const media = JSON.parse(localStorage.getItem(section + 'Media') || '[]');
        texts.forEach((text, idx) => {
          result.push({
            id: `${section}-text-${idx}`,
            section,
            text,
            media: media.slice(idx, idx + 1)
          });
        });
        // Also handle extra media if no text
        if (media.length > texts.length) {
          for (let i = texts.length; i < media.length; i++) {
            result.push({
              id: `${section}-media-${i}`,
              section,
              text: '',
              media: [media[i]]
            });
          }
        }
      });
      return result;
    }

    function renderCards() {
      const grid = document.getElementById("contentGrid");
      const searchQuery = document.getElementById("searchBar").value.toLowerCase();
      allCards = loadAllData().filter(item =>
        item.section.toLowerCase().includes(searchQuery) ||
        item.text.toLowerCase().includes(searchQuery)
      );
      const totalPages = Math.ceil(allCards.length / itemsPerPage);
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageItems = allCards.slice(start, end);

      grid.innerHTML = "";
      pageItems.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h2>${item.section.charAt(0).toUpperCase() + item.section.slice(1)}</h2>
          <p>${item.text}</p>
          <div class="media">
            ${item.media.map(file => {
              if (!file) return '';
              if (file.type.startsWith("image/")) {
                return `<img src="${file.src}" />`;
              } else if (file.type.startsWith("video/")) {
                return `<video src="${file.src}" controls></video>`;
              }
              return '';
            }).join('')}
          </div>
          <button class="delete-btn" onclick="deleteCard('${item.id}')">Delete</button>
        `;
        grid.appendChild(card);
      });

      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = currentPage === totalPages || totalPages === 0;
    }

    function deleteCard(id) {
      const [section, type, idx] = id.split('-');
      if (type === "text") {
        const texts = JSON.parse(localStorage.getItem(section + 'Texts') || '[]');
        texts.splice(idx, 1);
        localStorage.setItem(section + 'Texts', JSON.stringify(texts));
      } else {
        const media = JSON.parse(localStorage.getItem(section + 'Media') || '[]');
        media.splice(idx, 1);
        localStorage.setItem(section + 'Media', JSON.stringify(media));
      }
      renderCards();
    }

    function changePage(dir) {
      currentPage += dir;
      renderCards();
    }

    // Initial render
    renderCards();
  </script>
</body>
</html>
